//>>built
require({cache:{"builder/SetPortalUrl":function(){define("dojo/parser dojo/on dojo/dom dojo/_base/lang dojo/_base/declare dojo/_base/html dojo/topic dojo/_base/config dojox/validate/regexp dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SetPortalUrl.html dojo/Evented dojo/request dojo/request/script dojo/Deferred dojo/keys dojo/cookie dojo/store/Memory jimu/dijit/URLComboBox jimu/dijit/Message jimu/dijit/LoadingIndicator jimu/portalUrlUtils jimu/utils ./tokenUtils ./utils dijit/form/TextBox dijit/form/ValidationTextBox esri/request esri/arcgis/OAuthInfo esri/IdentityManager".split(" "),
function(p,h,q,d,g,b,e,f,A,l,r,w,B,C,s,D,t,x,u,y,E,H,z,k,m,n,J,K,I,F,G,v){return g([C,l,r,w],{baseClass:"jimu-set-portal-url",templateString:B,label:"setportalurl",defaultExpires:20160,invalidInput:!0,_portalUrlInputStatus:"uncheck",_validPortalUrls:null,_UrlEnterKeyDown:!1,_continueClick:!1,_oauthCheckError:null,currentDef:null,signinInfo:null,currentPortalUrl:null,postMixInProperties:function(){this.nls=window.builderNls.setPortalUrl;var a=window.builderNls.settings.appId;this.nls.appIdTip=a||"";
this.nls.appIdPlaceHolder=a||""},postCreate:function(){this.inherited(arguments);this.signinInfos=[];this._validPortalUrls=[];this.loading||(this.loading=new z);this.loading.placeAt(this.domNode);this.loading.show();this.loadingUrl=b.create("div",{"class":"loadingUrl"},this.portalUrlInput.domNode);this.invalidUrl=b.create("div",{"class":"invalidUrl"},this.portalUrlInput.domNode);this.validUrl=b.create("div",{"class":"validUrl"},this.portalUrlInput.domNode);this.signinInfo={portalUrl:"",supportsOAuth:!1,
appId:null};b.addClass(this.portalUrlInput.domNode,"portalUrlInput");this._getFAQHelpLink().then(d.hitch(this,function(a){b.setStyle(this.faqNode,"display","inline-block");b.setAttr(this.faqNode,"href",a)}));this._getSigninInfos().then(d.hitch(this,function(a){var c=new y({data:a});this.signinInfos=a;this.portalUrlInput.set("store",c);this.portalUrlInput.set("searchAttr","portalUrl");this.currentPortalUrl?this.portalUrlInput.set("value",this.currentPortalUrl):a[0]&&a[0].portalUrl&&this.portalUrlInput.set("value",
a[0].portalUrl)}),d.hitch(this,function(a){console.error(a)})).always(d.hitch(this,function(){this.loading.hide()}))},_writeWabCurrentPortalUrlToCookie:function(a){u("wab_portalurl",a,{path:"/webappbuilder"});u("wab_portalurl",a,{path:"/webapp"});u("wab_portalurl_persistent",a,{path:"/",expires:365})},_getFAQHelpLink:function(){var a=new t;window.isXT?s("/webappbuilder/help/cxhelp.js",{handleAs:"json"}).then(d.hitch(this,function(c){var b="#";c&&(c.m&&c.m["120000962"])&&(b="/webappbuilder/help/"+
c.m["120000962"]);a.resolve(b)}),d.hitch(this,function(c){console.warn(c);a.resolve("#")})):a.resolve("#");return a},_getSigninInfos:function(){var a=new t;s("/builder/rest/signininfo/getsignininfos",{handleAs:"json"}).then(d.hitch(this,function(c){c.success?a.resolve(c.infos):a.resolve([])}),d.hitch(this,function(c){a.reject(c)}));return a},setPortalUrl:function(a,c){this._oauthCheckError={portalUrl:a,error:c};this.currentPortalUrl=a;this.portalUrlInput.set("value",a)},_isValidAppIdInPortalUrl:function(a){return!this._oauthCheckError?
!0:k.isSamePortalUrl(a,this._oauthCheckError.portalUrl)&&("invalid_client_id"===this._oauthCheckError.error||"invalid_redirect_uri"===this._oauthCheckError.error)?!1:!0},_onPortalUrlKeyDown:function(a){(a.keyCode?a.keyCode:a.which)===x.ENTER?(this._UrlEnterKeyDown=!0,this.portalUrlInput.onBlur()):(this._continueClick=this._UrlEnterKeyDown=!1,this._portalUrlInputStatus="uncheck",this._hideAllStatus(),b.setStyle(this.appIdDiv,"display","none"),this.appIdInput.set("value",""),this._cancelValidating())},
_cancelValidating:function(){this.currentDef&&!this.currentDef.isCanceled()&&(this._portalUrlInputStatus="uncheck",this.currentDef.cancel(),b.setStyle(this.invalidUrl,"display","none"),b.setStyle(this.errorRemind,"display","none"))},_onPortalUrlBlur:function(){this._switchPortalUrlInputStatus()},_switchPortalUrlInputStatus:function(){if("checking"!==this._portalUrlInputStatus){b.setStyle(this.appIdDiv,"display","none");var a=this.portalUrlInput.get("value");0>a.toLowerCase().indexOf("http://")&&0>
a.toLowerCase().indexOf("https://")&&(a=k.setHttpProtocol(a));a=k.getStandardPortalUrl(a);if(this._isValidPortalUrl(a)){var c=this._getSigninInfo(a);c.portalUrl=a;this._showValidStatus();(this.signinInfo=c)&&(c.isWebTier||!c.supportsOAuth)?this._UrlEnterKeyDown&&this._onContinue():c&&c.appId?(this.appIdInput.set("value",c.appId),this._UrlEnterKeyDown&&this._onContinue()):(b.setStyle(this.appIdDiv,"display","block"),this._UrlEnterKeyDown=!1,this.appIdInput.set("value",""))}else this.appIdInput.set("value",
""),this._UrlEnterKeyDown=!1,this._cancelValidating(),this._validatePortal()}},_isValidPortalUrl:function(a){for(var c=0,b=this._validPortalUrls.length;c<b;c++)if(k.isSamePortalUrl(a,this._validPortalUrls[c]))return!0;return!1},_onPortalUrlChange:function(){this._switchPortalUrlInputStatus()},_onAppIdInputKeyDown:function(a){if((a.keyCode?a.keyCode:a.which)===x.ENTER)this.signinInfo.appId=this.appIdInput.get("value"),this.continueBtn.focus(),this.continueBtn.click(),a.stopPropagation()},_onAppIdInputChange:function(){var a=
this.signinInfo.appId,c=this.appIdInput.get("value");this.signinInfo.appId=c;this.signinInfo.supportsOAuth&&!this.signinInfo.appId?b.addClass(this.continueBtn,"Cont-btn-disable"):(b.removeClass(this.continueBtn,"Cont-btn-disable"),a!==c&&b.removeClass(this.appIdInput.domNode,"errorStatus"))},_updateSigninInfo:function(a){var c=new t;s("/builder/rest/signininfo/setsignininfo",{handleAs:"json",data:a,method:"POST"}).then(d.hitch(this,function(b){b.success&&this._writeWabCurrentPortalUrlToCookie(a.portalUrl);
c.resolve(b)}),d.hitch(this,function(a){c.reject(a)}));return c},_allowNamedorLocal:function(a){var c="^"+A.url({allowNamed:!1,allLocal:!1});return RegExp(c,"g").test(a)},_validatePortalExist:function(a){var c=new t;a=k.getPortalSelfInfoUrl(a);a=k.setHttpsProtocol(a);this.currentDef=F({url:a,content:{f:"json"},handleAs:"json",timeout:6E4},{useProxy:!0});this.currentDef.then(d.hitch(this,function(){c.resolve(!0)}),d.hitch(this,function(a){a=a.status||a.xhr||a.xhr.status;401===a||403===a?c.resolve(!0):
c.resolve(!1)}));return c},_validatePortal:function(){this.portalUrlInput.get("value")?b.setStyle(this.remind,"display","none"):b.setStyle(this.remind,"display","block");var a=this.portalUrlInput.get("value");a&&(this.portalUrlInput.validator(this.portalUrlInput.get("value"))&&(a=this.portalUrlInput.get("value")),0>a.toLowerCase().indexOf("http://")&&0>a.toLowerCase().indexOf("https://")&&(a=k.setHttpProtocol(a)),/www.arcgis.com/gi.test(a)||!this._allowNamedorLocal(a)?this._showInvalidStatus():(this._showValidatingStatus(),
a=k.getStandardPortalUrl(a),b.addClass(this.continueBtn,"Cont-btn-disable"),this._validatePortalExist(a).then(d.hitch(this,function(c){c?this._postProcessPortal(a):(this._showInvalidStatus(),b.setStyle(this.appIdDiv,"display","none"))}))))},_getPortalSelf:function(a){var c={url:a+"/sharing/rest/portals/self",content:{f:"json"},handleAs:"json",timeout:15E3,callbackParamName:"callback",preventCache:!0};if(a=n.getPortalCredential(a))a.token&&(c.content.token=a.token),a.ssl&&(c.url=k.setHttpsProtocol(c.url));
return F(c)},_postProcessPortal:function(a){this.currentDef=n.isWebTierPortal(a);this.currentDef.then(d.hitch(this,function(c){var f=n.getPortalCredential(a);f&&(f.ssl&&(a=k.setHttpsProtocol(a)),e.publish("userSignIn",f));this.currentDef=f=this._getPortalSelf(a);this.signinInfo={portalUrl:a};f.then(d.hitch(this,function(f){this.portalSelfInfo=f;if(!f.isPortal&&!f.urlKey)this._showInvalidStatus(),console.error("invalid name");else{var d=this._getSigninInfo(a);d||this.signinInfos.push(this.signinInfo);
this._isValidPortalUrl(a)||this._validPortalUrls.push(a);this.signinInfo.supportsOAuth=f.supportsOAuth;if(c)this.signinInfo.isWebTier=!0,this._showValidStatus(),b.removeClass(this.continueBtn,"Cont-btn-disable");else if(this.signinInfo.appId=d?d.appId:"",this.signinInfo.supportsOAuth?this.signinInfo.appId?(this._isValidAppIdInPortalUrl(a)||(b.setStyle(this.appIdDiv,"display","block"),b.addClass(this.appIdInput.domNode,"errorStatus")),this.appIdInput.set("value",this.signinInfo.appId)):b.setStyle(this.appIdDiv,
"display","block"):b.setStyle(this.appIdDiv,"display","none"),this._showValidStatus(),b.removeClass(this.continueBtn,"Cont-btn-disable"),f=b.getStyle(this.appIdDiv,"display"),this.signinInfo.supportsOAuth&&"none"!==f)b.addClass(this.continueBtn,"Cont-btn-disable"),this.appIdInput.focus();else if(this._UrlEnterKeyDown||this._continueClick)this._onContinue(),this._UrlEnterKeyDown=this._continueClick=!1}}),d.hitch(this,function(a){this._showInvalidStatus();console.error(a)}))}),d.hitch(this,function(a){this._showInvalidStatus();
console.error(a)}))},_getSigninInfo:function(a){for(var c=0;c<this.signinInfos.length;c++)if(k.isSamePortalUrl(this.signinInfos[c].portalUrl,a))return this.signinInfos[c];return null},_hideAllStatus:function(){b.setStyle(this.loadingUrl,"display","none");b.setStyle(this.validUrl,"display","none");b.setStyle(this.invalidUrl,"display","none");b.setStyle(this.errorRemind,"display","none")},_showValidStatus:function(){b.removeClass(this.portalUrlInput.domNode,"errorStatus");b.setStyle(this.loadingUrl,
"display","none");b.setStyle(this.validUrl,"display","block");b.setStyle(this.invalidUrl,"display","none");b.setStyle(this.errorRemind,"display","none");this.invalidInput=!1;this._portalUrlInputStatus="checked"},_showValidatingStatus:function(){b.removeClass(this.portalUrlInput.domNode,"errorStatus");b.setStyle(this.loadingUrl,"display","block");b.setStyle(this.validUrl,"display","none");b.setStyle(this.invalidUrl,"display","none");b.setStyle(this.errorRemind,"display","none");this.invalidInput=!0;
this._portalUrlInputStatus="checking"},_showInvalidStatus:function(){b.addClass(this.portalUrlInput.domNode,"errorStatus");b.setStyle(this.portalUrlInput.domNode,"data-dojo-props","missingMessage:'IPUT URL'");b.setStyle(this.loadingUrl,"display","none");b.setStyle(this.validUrl,"display","none");b.setStyle(this.invalidUrl,"display","block");b.setStyle(this.errorRemind,"display","block");var a=this.portalUrlInput.get("value");/www.arcgis.com/gi.test(a)||!this._allowNamedorLocal(a)?this.errorRemind.innerHTML=
this.nls.errOrg:this.errorRemind.innerHTML=this.nls.errPrefix+a+"\x3cbr\x3e"+this.nls.errRemind;this.invalidInput=!0;this._portalUrlInputStatus="checked"},_onContinue:function(){this.invalidInput||(this.signinInfo.isWebTier?e.publish("switchToMainPage",this.signinInfo):this.signinInfo.supportsOAuth?this.signinInfo.appId?this._updateSigninInfo(this.signinInfo).then(d.hitch(this,function(a){a.success&&this._oauthSignIn(this.signinInfo.portalUrl,this.signinInfo.appId)})):this.appIdInput.focus():(this._continueClick=
this._UrlEnterKeyDown=!1,e.publish("switchToSignin",d.clone(this.signinInfo))))},_oauthSignIn:function(a,c){n.signOutAll();a=k.getStandardPortalUrl(a);var b=new G({appId:c,portalUrl:a,expiration:this.defaultExpires,authNamespace:"/",popup:!1});v.registerOAuthInfos([b]);b=k.getSharingUrl(a);v.getCredential(b)}})})},"jimu/dijit/URLComboBox":function(){define(["dojo/_base/declare","dojo/_base/html","dijit/form/ComboBox","dojox/validate/regexp"],function(p,h,q,d){return p([q],{required:!0,invalidMessage:"Invalid url.",
trim:!0,rest:!0,allowNamed:!0,allLocal:!1,declaredClass:"jimu.dijit.URLComboBox",postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.urlInput;this.invalidMessage=this.nls.invalidUrl},postCreate:function(){this.inherited(arguments);h.addClass(this.domNode,"jimu-url-combobox")},validator:function(g){var b="^"+d.url({allowNamed:this.allowNamed,allLocal:this.allLocal}),b=RegExp(b,"g").test(g);return this.rest?(g=/\/rest\/services/gi.test(g),b&&g):b}})})},"builder/PortalSignIn":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/on dojo/topic dojo/_base/html dojo/dom-form dojo/_base/sniff dojo/request/registry dojo/keys dojo/cookie dojo/json dojo/aspect dojo/Deferred dojo/promise/all dojo/io-query dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/PortalSignIn.html esri/lang esri/request esri/arcgis/OAuthInfo esri/IdentityManager jimu/portalUrlUtils jimu/portalUtils jimu/utils jimu/dijit/CheckBox jimu/dijit/LoadingShelter jimu/dijit/Message ./tokenUtils".split(" "),
function(p,h,q,d,g,b,e,f,A,l,r,w,B,C,s,D,t,x,u,y,E,H,z,k,m,n,J,K,I,F,G,v){return p([x,u,y],{templateString:E,nls:null,defaultExpires:20160,label:"signin",postMixInProperties:function(){this.inherited(arguments);this.nls=window.builderNls.portalSignIn},postCreate:function(){this.inherited(arguments);this._hideAppIdTip();this._bindEvents()},_hideAppIdTip:function(){e.setStyle(this.appIdTipSection,"display","none")},_bindEvents:function(){this.remember=new I({label:this.nls.remember,checked:!1},this.remember);
this.own(g(this.password,"blur",h.hitch(this,this.changeSigninStatus)));this.own(g(this.domNode,"keydown",h.hitch(this,function(a){(a.keyCode?a.keyCode:a.which)===r.ENTER&&this._onSigninClick()})))},_generateTokenSignIn:function(a){var c=new s,f=v.xtGetCredentialFromCookie(a);if(f)return c.resolve(f),c;v.removeWabAuthCookie();a=n.getStandardPortalUrl(a);var d=n.setHttpsProtocol(a),f="/proxy.js?"+d+"/sharing/generateToken";this.shelter.show(this.nls.signingIn+"...");l(f,{handleAs:"json",method:"POST",
data:{request:"getToken",username:e.getAttr(this.username,"value"),password:e.getAttr(this.password,"value"),referer:window.location.host,expiration:this.remember.checked?this.defaultExpires:120,f:"json"},headers:{"X-Requested-With":null}}).then(h.hitch(this,function(f){if(f&&f.token){this._clearUserPassword();var e="/proxy.js?"+n.getCommunitySelfUrl(d),g=this._getPortalSelf(f.token),e=l(e,{handleAs:"json",method:"POST",data:{token:f.token,f:"json"},headers:{"X-Requested-With":null}});D([g,e]).then(h.hitch(this,
function(d){this.shelter.hide();var e=d[0];d=d[1];if(d.orgId){var l=n.getProtocol(a)+":";!e.isPortal&&e.urlKey&&(this.signinInfo.portalUrl=l+"//"+e.urlKey.toLowerCase()+"."+e.customBaseUrl);d.username&&(e={server:n.getStandardPortalUrl(this.signinInfo.portalUrl),token:f.token,userId:d.username,expires:f.expires,referer:window.location.host,scope:"portal",isAdmin:"org_admin"===d.role},d=v.saveAndRegisterCookieToCredential(e),b.publish("userSignIn",d),c.resolve(e))}else new G({message:this.nls.namedUserTip,
container:document.body})}),h.hitch(this,function(a){console.error(a);this._loginStatus(!0);c.reject(a)}))}else this.shelter.hide(),this._loginStatus(!0),c.reject()}),h.hitch(this,function(a){this.shelter.hide();console.error(a);this._loginStatus(!0);c.reject(a)}));return c},setSigninInfo:function(a){this.signinInfo=a;e.setStyle(this.domNode,"display","block");var b=n.getStandardPortalUrl(a.portalUrl);this.forgot.href=b+"/home/troubleshoot.html";v.xtGetCredentialFromCookie(a.portalUrl)&&this._onSigninClick()},
_getPortalSelf:function(a){var b={url:n.getPortalSelfInfoUrl(this.signinInfo.portalUrl),content:{f:"json"},handleAs:"json",callbackParamName:"callback",preventCache:!0};a&&(b.content.token=a);return z(b)},_onSigninClick:function(){this._generateTokenSignIn(this.signinInfo.portalUrl).then(h.hitch(this,function(){b.publish("switchToMainPage",this.signinInfo)}),h.hitch(this,function(a){console.error(a)}))},_onBackClick:function(){b.publish("switchToSetPortalUrl")},_loginStatus:function(a){a?(this.username.focus(),
e.setStyle(this.errorNode,"display","block")):e.setStyle(this.errorNode,"display","none")},_clearUserPassword:function(){this.username.value="";this.password.value=""},changeSigninStatus:function(){this.password.value?e.removeClass(this.signin,"signin-btn-disable"):e.hasClass(this.signin,"signin-btn-disable")||e.addClass(this.signin,"signin-btn-disable")}})})},"dojo/request/registry":function(){define(["require","../_base/array","./default!platform","./util"],function(p,h,q,d){function g(b,d){for(var l=
e.slice(0),g=0,h;h=l[g++];)if(h(b,d))return h.request.call(null,b,d);return q.apply(null,arguments)}function b(b,d){var e;d?(e=b.test?function(d){return b.test(d)}:b.apply&&b.call?function(){return b.apply(null,arguments)}:function(d){return d===b},e.request=d):(e=function(){return!0},e.request=b);return e}var e=[];g.register=function(d,g,l){var r=b(d,g);e[l?"unshift":"push"](r);return{remove:function(){var b;~(b=h.indexOf(e,r))&&e.splice(b,1)}}};g.load=function(b,d,e,h){b?p([b],function(b){q=b;e(g)}):
e(g)};d.addCommonMethods(g);return g})},"url:builder/templates/SetPortalUrl.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"content" data-dojo-attach-point\x3d"portalContent"\x3e\r\n    \x3cp class \x3d "specify-text-url"\x3e${nls.tip}\x3c/p\x3e \r\n\r\n    \x3cdiv class\x3d"portalUrlDiv" id\x3d"portalUrlDiv"\x3e\r\n      \x3cinput class\x3d"portalUrlInput" data-dojo-attach-point\x3d"portalUrlInput" name\x3d"portalUrl" type\x3d"text"\r\n      data-dojo-type\x3d"jimu/dijit/URLComboBox" data-dojo-attach-event\x3d"KeyDown: _onPortalUrlKeyDown,Change:_onPortalUrlChange,Blur:_onPortalUrlBlur"\r\n      data-dojo-props\x3d"rest:false,missingMessage:\'Please input portalUrl.\', invalidMessage: \'Invalid Portal URL\', allowNamed:true, allowLocal:true" /\x3e\r\n      \x3cdiv class\x3d"Remind" data-dojo-attach-point\x3d"remind" \x3e \r\n        \x3ctable\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd\x3e${nls.example}:\x3c/td\x3e\x3ctd\x3ehttp://myportal.company.com/arcgis\x3c/td\x3e\r\n          \x3c/tr\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd\x3e\x3c/td\x3e\x3ctd\x3ehttp://orgname.maps.arcgis.com\x3c/td\x3e\r\n          \x3c/tr\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"errorRemind" data-dojo-attach-point\x3d"errorRemind"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"appIdDiv" data-dojo-attach-point\x3d"appIdDiv"\x3e\r\n      \x3cp\x3e\r\n        \x3cspan\x3e\r\n          ${nls.appIdTip}\r\n        \x3c/span\x3e\r\n        \x3cspan\x3e(\x3c/span\x3e\r\n        \x3ca href\x3d"http://developers.arcgis.com/web-appbuilder/guide/getstarted.htm#ESRI_SECTION1_7BEAC94A35A945A58073127C1BE7359A" target\x3d"_blank"\x3e?\x3c/a\x3e\r\n        \x3cspan\x3e)\x3c/span\x3e\r\n      \x3c/p\x3e\r\n      \x3cinput type\x3d"text" class\x3d"appIdInput" data-dojo-attach-point\x3d"appIdInput" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-event\x3d"Change: _onAppIdInputChange,KeyDown: _onAppIdInputKeyDown"\r\n      data-dojo-props\x3d"required:true,placeHolder:\'${nls.appIdPlaceHolder}\'"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"ContinueBtn jimu-float-trailing" data-dojo-attach-point\x3d"continueBtn" data-dojo-attach-event\x3d"click:_onContinue"\x3e\r\n      ${nls.continueBtn}\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"trouble-shooting"\x3e\r\n      \x3ca data-dojo-attach-point\x3d"faqNode" target\x3d"_blank"\x3e${nls.faq}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:builder/templates/PortalSignIn.html":'\x3cdiv class\x3d"jimu-portal-signin"\x3e\r\n  \x3clabel data-dojo-attach-point\x3d"errorNode" class\x3d"error-message"\x3e${nls.errorMessage}\x3c/label\x3e\r\n  \x3cdiv class\x3d"signin-content" data-dojo-attach-point\x3d"signinContentNode"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"appIdTipSection" class\x3d"appid-tip-section" style\x3d"display:none;"\x3e\r\n      \x3cdiv\x3e${nls.appIdTip1}\x3c/div\x3e\r\n      \x3cdiv style\x3d"margin-top:20px;"\x3e\r\n        \x3cspan\x3e${nls.appIdTip2}\x3c/span\x3e\r\n        \x3ca class\x3dhelp-link target\x3d_blank href\x3d"http://doc.arcgis.com/en/arcgis-online/share-maps/add-items.htm#ESRI_SECTION2_20AF85308FD548B5ADBAE28836F66D3F"\x3e${nls.here}\x3c/a\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"form"\x3e\r\n      \x3clabel\x3e${nls.username}\x3c/label\x3e\r\n      \x3cinput type\x3d"text" tabindex\x3d"1" data-dojo-attach-point\x3d"username" /\x3e\r\n      \x3clabel\x3e${nls.password}\x3c/label\x3e\r\n      \x3ca data-dojo-attach-point\x3d"forgot" style\x3d"margin-left:10px;" target\x3d"_blank" href\x3d"#"\x3e${nls.forgot}\x3c/a\x3e\r\n      \x3cinput type\x3d"password" tabindex\x3d"2" data-dojo-attach-point\x3d"password" /\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"remember"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"operations"\x3e\r\n      \x3cdiv class\x3d"btn signin-btn jimu-float-trailing" data-dojo-attach-point\x3d"signin" tabindex\x3d"3" data-dojo-attach-event\x3d"onclick:_onSigninClick" \x3e${nls.con}\x3c/div\x3e\r\n      \x3cdiv class\x3d"btn jimu-trailing-margin2 jimu-float-trailing" data-dojo-attach-point\x3d"btnBack" data-dojo-attach-event\x3d"onclick:_onBackClick"\x3e${nls.back}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/parser dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/cookie dojo/request/xhr dojo/topic dijit/registry builder/tokenUtils jimu jimu/utils jimu/portalUrlUtils jimu/portalUtils jimu/dijit/ViewStack jimu/dijit/LoadingShelter ./SetPortalUrl ./PortalSignIn ./utils esri/config esri/urlUtils esri/request esri/IdentityManager".split(" "),function(p,h,q,d,g,b,e,f,A,l,r,w,B,C,s,D,t,x,u,y,E,H,z){function k(b){h.setStyle("pre-main-page","display","block");h.setStyle("main-page","display",
"none");null===m&&(m=new s({viewType:"dijit",views:[new t({},"portal-url-div"),new x({},"signin-div")]},"pre-main-page"),m.switchView("setportalurl"))}var m=null;f.subscribe("switchToSetPortalUrl",function(){k();m.switchView("setportalurl")});f.subscribe("switchToSignin",function(b){k();var d=window.location.href.replace("action\x3dsetportalurl","action\x3dsignin");w.changeLocation(d);m.switchView("signin");m.getViewByLabel("signin").setSigninInfo(b)});l.removeEsriAuthCookieStorage();z._oAuthDfd=
null;(function(){y.defaults.io.proxyUrl="/proxy.js";var d=b("wab_portalurl_persistent");e("/builder/rest/signininfo/getsignininfo",{query:{portalUrl:d},handleAs:"json"}).then(function(b){if(b.success)if(b=b.info){var e;e=window.originalHash.replace("#","");e=w.hashToObject(e);if(e.access_token){var g=u.removeActionFromUrl(window.location.href);w.changeLocation(g);e=l.registerAuth2Hash(e);f.publish("userSignIn",e);f.publish("switchToMainPage",b)}else e.error&&e.error_description?(g="unknown_error",
"invalid_request"===e.error?"Invalid client_id"===e.error_description?g="invalid_client_id":"Invalid redirect_uri"===e.error_description&&(g="invalid_redirect_uri"):g="access_denied"===e.error?"access_denied":"unknown_error",f.publish("switchToSetPortalUrl"),m.getViewByLabel("setportalurl").setPortalUrl(b.portalUrl,g)):"setportalurl"===queryObject.action?(f.publish("switchToSetPortalUrl"),m.getViewByLabel("setportalurl").setPortalUrl(b.portalUrl)):"signin"===queryObject.action?b.supportsOAuth||b.isWebTier?
(f.publish("switchToSetPortalUrl"),m.getViewByLabel("setportalurl").setPortalUrl(b.portalUrl)):f.publish("switchToSignin",b):b.isWebTier?(f.publish("switchToSetPortalUrl"),m.getViewByLabel("setportalurl").setPortalUrl(b.portalUrl)):f.publish("switchToMainPage",b)}else f.publish("switchToSetPortalUrl"),m.getViewByLabel("setportalurl").setPortalUrl(d);else console.log("Unknow error")})})()});